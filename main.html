<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial scale=1.0">
    <title>SchoolForum</title>
    <!--Connect stylesheet to HTML file-->
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

    <!--Create navigation-bar-->
    <nav>
        <div class="nav-left">
            <!--insert logo-->
            <img src="SchoolForumLogo.png" class="logo">
            <ul>
                <!--insert notifications, create post and inbox icons-->
                <li id="notifications-btn"> <img src="SchoolForumNotifications.png"></li>
                <li><img src="SchoolForumInbox.png"></li>
                <li><img src="SchoolForumCreatePost.png"></li>
            </ul>
            <div id="notifications-container" class="hidden">
                <!-- Hier worden de meldingen weergegeven -->
            </div>

        </div>
        <div class="nav-right">
            <!--add navigation bar icon-->
            <div class="search-box">
                <img src="SchoolForumSearch.png">
                <input type="text" placeholder="Search...">
            </div>
            <!--add profile picture and online indicator-->
            <div class="nav-user-icon online">
                <img id="user-icon" src="SchoolForumProfilePicture.png" alt="User Icon">
                <p id="change-icon-link">Change User Icon</p>
            </div>

        </div>
    </nav>
    <!--make a container with all settings of left/right-sidebar and main-content-->
    <div class="container">

        <!--------------------------Left-sidebar-------------------------->
        <div class="left-sidebar">
            <div class="imp-links">
                <a href="#"><img src="SchoolForumPostsIcon.png">Latest Posts</a>
                <a href="#"><img src="SchoolForumContactsIcon.png">Contacts</a>
                <a href="#"><img src="SchoolForumGroupsIcon.png">Groups</a>
                <a href="#">See More</a>
            </div>
            <div class="shortcut-links">

            </div>
        </div>

        <!--------------------------Main-content-------------------------->
        <style>
            /* Aangepaste stijlen voor posts */
            #posts-container {
                max-width: 600px;
                margin: 0 auto;
            }

            .post {
                border: 1px solid #ccc;
                margin: 10px 0;
                padding: 10px;
                border-radius: 8px;
                background-color: #f5f5f5;
            }

            .post-text {
                font-size: 16px;
            }

            .post-metadata {
                font-size: 12px;
                color: #888;
            }
        </style>

        <div class="main-content">

            <div id="posts-container">
                <!-- Hier worden de live posts weergegeven -->
            </div>
            <div>
                <form id="post-form">
                    <textarea id="post-input" placeholder="Create Post..."></textarea>
                    <button type="submit">Post</button>
                </form>
            </div>

            <!------------------------↓ POSTS(TIME) ↓------------------------>
            <script>
                // Event listener for the post form submission
                document.getElementById("post-form").addEventListener("submit", function (event) {
                    event.preventDefault();
                    const message = document.getElementById("post-input").value;

                    // Send the new post to the server
                    fetch('http://localhost:5500/api/posts', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message }),
                    })
                        .then(response => response.json())
                        .then(response => {
                            console.log(response);
                            // After posting a new message, fetch all posts and update the display
                            getPosts();
                        })
                        .catch(error => console.error('Error:', error));

                    document.getElementById("post-input").value = "";
                });

                // Function to get a formatted date and time
                function getFormattedDateTime(timestamp) {
                    const date = new Date(timestamp);
                    const day = date.getDate();
                    const month = date.getMonth() + 1; // Maanden zijn zero-based, dus voeg 1 toe
                    const year = date.getFullYear();
                    const hours = date.getHours();
                    const minutes = date.getMinutes();

                    // Voeg voorloopnullen toe indien nodig
                    const formattedDay = day < 10 ? `0${day}` : day;
                    const formattedMonth = month < 10 ? `0${month}` : month;
                    const formattedHours = hours < 10 ? `0${hours}` : hours;
                    const formattedMinutes = minutes < 10 ? `0${minutes}` : minutes;

                    return `${formattedMonth}/${formattedDay}/${year}, ${formattedHours}:${formattedMinutes}`;
                }


                // Function to fetch and display posts
                function getPosts() {
                    // Fetch all posts from the server
                    fetch('http://localhost:5500/api/posts')
                        .then(response => response.json())
                        .then(posts => {
                            const postsContainer = document.getElementById("posts-container");
                            postsContainer.innerHTML = "";

                            // Loop through each post and create a post element
                            posts.forEach(post => {
                                const postElement = document.createElement("div");
                                postElement.classList.add("post");

                                // Create a paragraph for the post text
                                postElement.innerHTML = `<div class="post-text">${post.message.replace(/\n/g, '<br>')}</div>`;

                                // Create a paragraph for the post metadata (date and time)
                                const postMetadata = document.createElement("p");
                                postMetadata.classList.add("post-metadata");
                                postMetadata.textContent = `Posted on: ${getFormattedDateTime(post.timestamp)}`;

                                // Append post text and metadata to the post element
                                postElement.appendChild(postMetadata);

                                // Append the post element to the posts container
                                postsContainer.appendChild(postElement);
                            });
                        })
                        .catch(error => console.error('Error:', error));
                }

                // Load posts on page load and set an interval to refresh periodically
                window.onload = function () {
                    getPosts();
                    setInterval(getPosts, 5000); // Refresh every 5 seconds
                };
            </script>
            <!------------------------↑ POSTS(TIME) ↑------------------------>
        </div>

        <!--------------------------Right-sidebar-------------------------->
        <div class="right-sidebar">
            <div class="sidebar-title">
                <h4>Conversation</h4>
                <a href="#">Hide Chat</a>
            </div>
            <div class="online-list">
                <div class="online">
                    <img src="SchoolForumProfilePicture.png">
                </div>
                <p>Sander Conings</p>
            </div>
            <div class="online-list">
                <div class="online">
                    <img src="SchoolForumProfilePicture.png">
                </div>
                <p>Jonathan Deprest</p>
            </div>
            <div class="online-list">
                <div class="online">
                    <img src="SchoolForumProfilePicture.png">
                </div>
                <p>Marco Castermans</p>
            </div>

        </div>
    </div>
    <script src="server.js"></script>
    <script src="script.js"></script>
    <script src="notifications.js"></script>
</body>

</html>